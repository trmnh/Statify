<ion-header>
  <ion-toolbar>
    <ion-title>Statistiques</ion-title>
    <ion-buttons slot="start">
      <ion-button (click)="goToHome()">
        <ion-icon name="arrow-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Sélecteur de période -->
  <ion-item>
    <ion-label>Période</ion-label>
    <ion-select [formControl]="selectedPeriodControl" interface="popover">
      <ion-select-option value="short_term"
        >4 dernières semaines</ion-select-option
      >
      <ion-select-option value="medium_term">6 derniers mois</ion-select-option>
      <ion-select-option value="long_term">Tout le temps</ion-select-option>
    </ion-select>
  </ion-item>

  <!-- Indicateur de chargement -->
  @if (loading$ | async) {
  <div class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Chargement des statistiques...</p>
  </div>
  }

  <!-- Message d'erreur -->
  @if (error$ | async; as error) {
  <ion-card color="danger">
    <ion-card-content>
      <ion-icon name="alert-circle-outline" size="large"></ion-icon>
      <h3>Erreur</h3>
      <p>{{ error }}</p>
      <ion-button fill="clear" (click)="ngOnInit()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Réessayer
      </ion-button>
    </ion-card-content>
  </ion-card>
  }

  <!-- Grille des graphiques -->
  @if (!(loading$ | async) && !(error$ | async)) {
  <ion-grid>
    <ion-row>
      <ion-col size="12" size-lg="6">
        <div class="chart-container">
          <div class="chart-header">
            <ion-icon name="people-outline"></ion-icon>
            <h3>Top Artistes</h3>
          </div>
          <div
            echarts
            [options]="artistsChartOption"
            style="height: 350px; width: 100%"
            [loading]="(loading$ | async) ?? false"
          ></div>
        </div>
      </ion-col>
      <ion-col size="12" size-lg="6">
        <div class="chart-container">
          <div class="chart-header">
            <ion-icon name="musical-notes-outline"></ion-icon>
            <h3>Top Pistes</h3>
          </div>
          <div
            echarts
            [options]="tracksChartOption"
            style="height: 350px; width: 100%"
            [loading]="(loading$ | async) ?? false"
          ></div>
        </div>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12" size-lg="6">
        <div class="chart-container">
          <div class="chart-header">
            <ion-icon name="pie-chart-outline"></ion-icon>
            <h3>Genres Musicaux</h3>
          </div>
          <div
            echarts
            [options]="genresChartOption"
            style="height: 350px; width: 100%"
            [loading]="(loading$ | async) ?? false"
          ></div>
        </div>
      </ion-col>
      <ion-col size="12" size-lg="6">
        <div class="chart-container">
          <div class="chart-header">
            <ion-icon name="time-outline"></ion-icon>
            <h3>Durée des Pistes</h3>
          </div>
          <div
            echarts
            [options]="durationChartOption"
            style="height: 350px; width: 100%"
            [loading]="(loading$ | async) ?? false"
          ></div>
        </div>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12">
        <div class="chart-container">
          <div class="chart-header">
            <ion-icon name="calendar-outline"></ion-icon>
            <h3>Activité d'écoute par heure</h3>
          </div>
          <div
            echarts
            [options]="activityChartOption"
            style="height: 400px; width: 100%"
            [loading]="(loading$ | async) ?? false"
          ></div>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>
  }
</ion-content>
