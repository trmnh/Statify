<ion-header>
  <ion-toolbar>
    <ion-title>Recherche</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="searchForm">
    <ion-searchbar
      formControlName="searchTerm"
      placeholder="Rechercher..."
      animated
    ></ion-searchbar>

    <ion-segment formControlName="searchType">
      <ion-segment-button value="track">
        <ion-label>Titres</ion-label>
      </ion-segment-button>
      <ion-segment-button value="artist">
        <ion-label>Artistes</ion-label>
      </ion-segment-button>
      <ion-segment-button value="album">
        <ion-label>Albums</ion-label>
      </ion-segment-button>
      <ion-segment-button value="playlist">
        <ion-label>Playlists</ion-label>
      </ion-segment-button>
    </ion-segment>
  </form>

  @if (isLoading) {
    <ion-spinner name="crescent"></ion-spinner>
  }

  @if (error) {
    <ion-text color="danger">
      <p>{{ error }}</p>
    </ion-text>
  }

  @if (!isLoading && !error && searchResults.length === 0 && searchForm.get('searchTerm')?.value) {
    <ion-text color="medium">
      <p>Aucun résultat trouvé</p>
    </ion-text>
  }

  <ion-list>
    @for (item of searchResults; track item.id) {
      <ion-item button (click)="playTrack(item.uri)">
        @if (item.images && item.images.length > 0) {
          <ion-thumbnail slot="start">
            <img [src]="item.images[0].url" [alt]="item.name">
          </ion-thumbnail>
        }
        <ion-label>
          <h2>{{ item.name }}</h2>
          @if (item.artists) {
            <p>{{ formatArtistNames(item.artists) }}</p>
          }
          @if (item.album) {
            <p>{{ item.album.name }}</p>
          }
        </ion-label>
      </ion-item>
    }
  </ion-list>
</ion-content>
